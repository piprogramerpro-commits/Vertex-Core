<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vertex Core | Sovereign System</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --bg: #0b0b0d; --side: #121214; --gold: #d4af37; --text: #efeff1; --secure: #00ff00; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 260px; background: var(--side); padding: 20px; border-right: 1px solid #222; display: flex; flex-direction: column; }
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 40px 15%; }
        .input-area { padding: 20px 15%; background: var(--bg); }
        .input-box { background: #1c1c1f; border: 1px solid #333; border-radius: 15px; padding: 10px 20px; display: flex; align-items: center; }
        input[type="text"] { background: transparent; border: none; color: white; flex: 1; padding: 10px; outline: none; }
        .btn-clip { background: none; border: none; color: var(--gold); cursor: pointer; font-size: 20px; margin-right: 10px; }
        #terminal-root { position: absolute; top: 10px; right: 10px; width: 300px; height: 150px; background: rgba(0,20,0,0.9); border: 1px solid var(--secure); color: var(--secure); font-family: monospace; font-size: 10px; padding: 10px; border-radius: 5px; display: none; }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2 style="color:var(--gold)">VERTEX</h2>
        <div style="flex:1"></div>
        <div style="color:var(--secure); font-size:10px; border:1px solid var(--secure); padding:5px; text-align:center;">üîê AES-256 ACTIVE</div>
    </div>
    <div id="main">
        <div id="terminal-root"> [SYS]> Archivos Listos...<br> [LOG]> Esperando Comando de Gemo... </div>
        <div id="chat-flow"></div>
        <div class="input-area">
            <div class="input-box">
                <input type="file" id="fileInput" style="display:none" onchange="uploadFile()">
                <button class="btn-clip" onclick="document.getElementById('fileInput').click()">üìé</button>
                <input type="text" id="userInput" placeholder="Escribe o sube un archivo..." onkeypress="if(event.key==='Enter') send()">
            </div>
        </div>
    </div>

    <script>
        let currentFileContent = "";

        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            const formData = new FormData();
            formData.append('file', file);
            const res = await fetch('/upload', { method: 'POST', body: formData });
            const data = await res.json();
            currentFileContent = data.content;
            alert("Archivo analizado: " + data.filename);
        }

        async function send() {
            const input = document.getElementById('userInput');
            const q = input.value; if(!q) return;
            const flow = document.getElementById('chat-flow');
            
            flow.innerHTML += `<div style="text-align:right; margin-bottom:20px;">${q}</div>`;
            input.value = '';

            const res = await fetch('/ask', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query: q, file_context: currentFileContent})
            });
            const d = await res.json();
            flow.innerHTML += `<div style="margin-bottom:20px; color:var(--gold);">${marked.parse(d.vertex_response)}</div>`;
            flow.scrollTop = flow.scrollHeight;
            currentFileContent = ""; // Limpiamos tras usar
        }
    </script>
</body>
</html>
