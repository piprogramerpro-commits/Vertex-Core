<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>VERTEX CORE | SYSTEM</title>
    <style>
        :root { --gold: #ffcc00; --gold-dark: #b8860b; --bg: #050505; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* AUTH OVERLAY */
        #auth-overlay { position: fixed; inset: 0; background: #000; z-index: 999; display: flex; align-items: center; justify-content: center; transition: 0.5s; }
        .auth-card { background: #111; padding: 40px; border: 2px solid var(--gold); border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(255,204,0,0.3); }
        .auth-card input { width: 100%; padding: 12px; margin: 15px 0; background: #000; border: 1px solid var(--gold); color: #fff; border-radius: 8px; }
        
        /* SIDEBAR */
        #sidebar { width: 280px; background: #000; border-right: 1px solid #222; display: flex; flex-direction: column; padding: 20px; }
        .new-chat { border: 1px solid #444; padding: 10px; border-radius: 5px; text-align: center; cursor: pointer; transition: 0.3s; }
        .new-chat:hover { border-color: var(--gold); background: rgba(255,204,0,0.1); }

        /* MAIN CHAT */
        #main { flex: 1; display: flex; flex-direction: column; background: radial-gradient(circle at center, #111 0%, #050505 100%); }
        #chat-container { flex: 1; overflow-y: auto; padding: 40px 15%; scroll-behavior: smooth; }
        .msg { margin-bottom: 30px; padding: 15px; border-radius: 10px; line-height: 1.6; max-width: 85%; }
        .msg.user { background: rgba(255,255,255,0.05); align-self: flex-end; border-right: 3px solid #fff; }
        .msg.vertex { background: rgba(255,204,0,0.02); align-self: flex-start; border-left: 3px solid var(--gold); box-shadow: 0 0 15px rgba(255,204,0,0.05); }

        /* INPUT AREA */
        .input-box { padding: 30px 15%; background: linear-gradient(transparent, #050505); }
        .input-wrapper { background: #181818; border: 1px solid #333; border-radius: 15px; display: flex; padding: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input#query { flex: 1; background: transparent; border: none; color: #fff; padding: 10px; outline: none; font-size: 16px; }
        
        .btn { background: var(--gold); color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn:hover { background: #fff; box-shadow: 0 0 20px #fff; }
        .blink { animation: blinker 1s linear infinite; color: var(--gold); }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h1 style="color:var(--gold); font-family:serif; letter-spacing:3px;">VERTEX CORE</h1>
        <p style="color:#888;">Ingresa al Sistema de Inteligencia Dorada</p>
        <input type="email" id="email" placeholder="tu@correo.com">
        <button class="btn" onclick="start(true)">REGISTRARSE (+30 ⚡)</button>
        <button class="btn" style="background:none; color:var(--gold); border:1px solid var(--gold); margin-top:10px;" onclick="start(false)">MODO INVITADO</button>
    </div>
</div>

<div id="sidebar">
    <div class="new-chat">+ New Synthesis</div>
    <div style="margin-top:auto; padding:15px; border-top:1px solid #222;">
        <div id="user-tag" style="color:var(--gold); font-size:12px; margin-bottom:5px;"></div>
        <div style="font-size:18px;">⚡ <span id="spark-count">--</span></div>
    </div>
</div>

<div id="main">
    <div id="chat-container"></div>
    <div class="input-box">
        <div class="input-wrapper">
            <input type="text" id="query" placeholder="Escribe tu comando aquí..." autocomplete="off">
            <button class="btn" onclick="send()">↑</button>
        </div>
    </div>
</div>

<script>
    let session = { email: '', registered: false };

    function start(reg) {
        const email = document.getElementById('email').value;
        if(reg && !email) return alert("Email requerido.");
        session.email = email || "guest_" + Math.random().toString(10).slice(2,6);
        session.registered = reg;
        document.getElementById('user-tag').innerText = session.email.toUpperCase();
        document.getElementById('auth-overlay').style.opacity = '0';
        setTimeout(() => document.getElementById('auth-overlay').style.display = 'none', 500);
    }

    async function send() {
        const q = document.getElementById('query');
        const container = document.getElementById('chat-container');
        if(!q.value) return;

        const userVal = q.value;
        container.innerHTML += `<div class="msg user"><b>Tú:</b><br>${userVal}</div>`;
        q.value = "";

        const vDiv = document.createElement('div');
        vDiv.className = "msg vertex";
        vDiv.innerHTML = `<b>VERTEX CORE:</b><br><span class="blink">Sintetizando respuesta neuronal...</span>`;
        container.appendChild(vDiv);
        container.scrollTop = container.scrollHeight;

        try {
            const r = await fetch('/ask', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query: userVal, email: session.email, is_registered: session.registered})
            });
            const d = await r.json();
            vDiv.innerHTML = `<b>VERTEX CORE:</b><br>${d.vertex_response}`;
            document.getElementById('spark-count').innerText = d.sparks_remaining;
        } catch(e) {
            vDiv.innerHTML = "<b>ERROR:</b> Conexión con el núcleo perdida.";
        }
        container.scrollTop = container.scrollHeight;
    }
    document.getElementById('query').addEventListener('keypress', (e) => { if(e.key === 'Enter') send(); });
</script>
</body>
</html>
